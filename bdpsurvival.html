<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>One-arm trial (OPC) example - survival probability at 5 years</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>\name{bdpsurvival}
\alias{bdpsurvival}
\alias{bdpsurvival,ANY-method}
\title{Bayesian Discount Prior: Survival Analysis}
\usage{
bdpsurvival(formula = formula, data = data, breaks = NULL, a0 = 0.1,
  b0 = 0.1, surv_time = NULL, alpha_max = 1, fix_alpha = FALSE,
  number_mcmc = 10000, weibull_scale = 0.135, weibull_shape = 3,
  two_side = TRUE)
}
\arguments{
\item{formula}{an object of class &ldquo;formula.&rdquo; Must have a survival object on
the left side and exactly two inputs on the right side: treatment and
historical. See &ldquo;Details&rdquo; for more information.}</p>

<p>\item{data}{data frame. A data frame with columns &#39;time&#39;, &#39;status&#39;,
&#39;treatment&#39;, and historical.&#39; See &ldquo;Details&rdquo; for required structure.}</p>

<p>\item{breaks}{vector. Breaks (interval starts) used to compose the breaks of the
piecewise exponential model. Do not include zero. Default breaks are the
quantiles of the input times.}</p>

<p>\item{a0}{scalar. Prior value for the gamma shape of the piecewise
exponential hazards. Default is 1.}</p>

<p>\item{b0}{scalar. Prior value for the gamma rate of the piecewise
exponential hazards. Default is 1.}</p>

<p>\item{surv_time}{scalar. Survival time of interest for computing the
probability of survival for a single arm (OPC) trial. Default is
overall, i.e., current+historical, median survival time.}</p>

<p>\item{alpha_max}{scalar. Maximum weight the discount function can apply.
Default is 1. For a two-arm trial, users may specify a vector of two values
where the first value is used to weight the historical treatment group and
the second value is used to weight the historical control group.}</p>

<p>\item{fix_alpha}{logical. Fix alpha at alpha_max? Default value is FALSE.}</p>

<p>\item{number_mcmc}{scalar. Number of Markov Chain Monte Carlo (MCMC)
simulations. Default is 10000.}</p>

<p>\item{weibull_scale}{scalar. Scale parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 0.135. For a two-arm trial, users may specify a vector of two
values where the first value is used to estimate the weight of the
historical treatment group and the second value is used to estimate the
weight of the historical control group.}</p>

<p>\item{weibull_shape}{scalar. Shape parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 3. For a two-arm trial, users may specify a vector of two values
where the first value is used to estimate the weight of the historical
treatment group and the second value is used to estimate the weight of the
historical control group.}</p>

<p>\item{two_side}{logical. Indicator of two-sided test for the discount
function. Default value is TRUE.}
}
\value{
\code{bdpsurvival} returns an object of class &ldquo;bdpsurvival&rdquo;.
The functions \code{\link{summary}} and \code{\link{print}} are used to obtain and
print a summary of the results, including user inputs. The \code{\link{plot}}
function displays visual outputs as well.</p>

<p>An object of class &ldquo;\code{bdpsurvival}&rdquo; is a list containing at least
the following components:
\describe{
 \item{\code{posterior_treatment}}{
   list. Entries contain values related to the treatment group:}
   \itemize{
     \item{\code{alpha_discount}}{
       numeric. Alpha value, the weighting parameter of the historical data.}
     \item{\code{p_hat}}{
       numeric. The posterior probability of the stochastic comparison
       between the current and historical data.}
     \item{\code{posterior_survival}}{
       vector. If one-arm trial, a vector of length \code{number_mcmc}
       containing the posterior probability draws of survival at
       \code{surv_time}.}
     \item{\code{posterior_flat_survival}}{
       vector. If one-arm trial, a vector of length \code{number_mcmc}
       containing the probability draws of survival at \code{surv_time}
       for the current treatment not augmented by historical treatment.}
     \item{\code{prior_survival}}{
       vector. If one-arm trial, a vector of length \code{number_mcmc}
       containing the probability draws of survival at \code{surv_time}
       for the historical treatment.}
     \item{\code{posterior_hazard}}{
       matrix. A matrix with \code{number_mcmc} rows and \code{length(breaks)}
       columns containing the posterior draws of the piecewise hazards
       for each interval break point.}
     \item{\code{posterior_flat_hazard}}{
       matrix. A matrix with \code{number_mcmc} rows and \code{length(breaks)}
       columns containing the draws of piecewise hazards for each interval
       break point for current treatment not augmented by historical treatment.}
     \item{\code{prior_hazard}}{
       matrix. A matrix with \code{number_mcmc} rows and \code{length(breaks)}
       columns containing the draws of piecewise hazards for each interval break point
       for historical treatment.}
  }
 \item{\code{posterior_control}}{
   list. If two-arm trial, contains values related to the control group
   analagous to the \code{posterior_treatment} output.}
 \item{\code{args1}}{
   list. Entries contain user inputs. In addition, the following elements
   are ouput:}
   \itemize{
     \item{\code{S_t}, \code{S_c}, \code{S0_t}, \code{S0_c}}{
       survival objects. Used internally to pass survival data between
       functions.}
     \item{\code{arm2}}{
       logical. Used internally to indicate one-arm or two-arm analysis.}
  }
}
}
\description{
\code{bdpsurvival} is used to estimate the survival probability
  (single arm trial; OPC) or hazard ratio (two-arm trial; RCT) for
  right-censored data using the survival analysis implementation of the
  Bayesian discount prior.
}
\details{
\code{bdpsurvival} uses a two-stage approach for determining the
  strength of historical data in estimation of a survival probability outcome.
  In the first stage, a Weibull distribution function is used as a
  \emph{discount function} that defines the maximum strength of the
  historical data (via \code{weibull_shape}, \code{weibull_scale}, and
  \code{alpha_max}) and discounts based on disagreement with the current data.
  Disagreement between current and historical data is determined by stochastically
  comparing the respective posterior distributions under noninformative priors.
  With a single arm survival data analysis, the comparison is the
  probability (\code{p}) that the current survival is less than the historical
  survival. For a two-arm survival data, analysis the comparison is the
  probability that the hazard ratio comparing treatment and control is
  different from zero. The comparison metric \code{p} is then
  input into the Weibull discount function and the final strength of the
  historical data is returned (alpha).</p>

<p>In the second stage, posterior estimation is performed where the discount
  function parameter, \code{alpha}, is used as a fixed value for all posterior
  estimation procedures.</p>

<p>To carry out a single arm (OPC) analysis, data for the current and
  historical treatments are specified in a dataframe. The dataframe must have
  columns with names &#39;time&#39;, &#39;status&#39;, &#39;treatment&#39;, and &#39;historical.&#39; Column
  &#39;time&#39; is the survival (censor) time of the event and &#39;status&#39; is the
  event indicator. The column &#39;treatment&#39; is used to indicate which observations
  are in the treatment and control group. A value of 1 indicates that the
  observation is in the treatment group. The column &#39;historical&#39; indicates
  whether the observation is from the historical data (1) or current data (0).
  The results are then based on the posterior probability of survival at
  \code{surv_time} for the current data augmented by the historical data.</p>

<p>Two-arm (RCT) analyses are specified similarly to a single arm trial. Again
  the input dataframe must have columns with names &#39;time&#39;, &#39;status&#39;,
  &#39;treatment&#39;, and &#39;historical.&#39; Column &#39;time&#39; is the survival (censor) time
  of the event and &#39;status&#39; is the event indicator. Now, the &#39;treatment&#39;
  column must use 0 to indicate the control group. The current data are
  augmented by historical data (if present) and the results are then based
  on the posterior distribution of the hazard ratio between the treatment
  and control groups.
}
\examples{</p>

<h1>One-arm trial (OPC) example - survival probability at 5 years</h1>

<h1>Simulate survival data for a single arm (OPC) trial</h1>

<p>time   &lt;- c(rexp(50, rate=1/20), rexp(50, rate=1/10))
status &lt;- c(rexp(50, rate=1/30), rexp(50, rate=1/30))
status &lt;- ifelse(time &lt; status, 1, 0)</p>

<h1>Collect data into a dataframe</h1>

<p>example_surv_1arm &lt;- data.frame(status     = status,
                                time       = time,
                                historical = c(rep(1,50),rep(0,50)),
                                treatment  = 1)</p>

<p>fit1 &lt;- bdpsurvival(Surv(time, status) ~ historical + treatment,
                    data = example_surv_1arm,
                    surv_time = 5)</p>

<p>print(fit1)
\dontrun{
plot(fit1)
}</p>

<h1>Two-arm trial (OPC) example</h1>

<h1>Simulate survival data for a two-arm trial</h1>

<p>time   &lt;- c(rexp(50, rate=1/20), # Current treatment
            rexp(50, rate=1/10), # Current control
            rexp(50, rate=1/30), # Historical treatment
            rexp(50, rate=1/5))  # Historical control
status &lt;- rexp(200, rate=1/40)
status &lt;- ifelse(time &lt; status, 1, 0)</p>

<h1>Collect data into a dataframe</h1>

<p>example_surv_2arm &lt;- data.frame(status     = status,
                                time       = time,
                                historical = c(rep(0,100),rep(1,100)),
                                treatment  = c(rep(1,50),rep(0,50),rep(1,50),rep(0,50)))</p>

<p>fit2 &lt;- bdpsurvival(Surv(time, status) ~ historical + treatment,
                       data = example_surv_2arm)</p>

<p>summary(fit2)</p>

<h3>Fix alpha at 1</h3>

<p>fit2_1 &lt;- bdpsurvival(Surv(time, status) ~ historical + treatment,
                      data = example_surv_2arm,
                      fix_alpha = TRUE)</p>

<p>summary(fit2_1)</p>

<p>}
\seealso{
\code{\link{plot,bdpsurvival-method}}, \code{\link{print,bdpsurvival-method}},
  and \code{\link{summary,bdpsurvival-method}} for details of each of the
  supported methods.
}</p>

</body>

</html>
